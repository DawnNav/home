<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>正在跳转 - {{ .Site.Title }}</title>
<meta name="theme-color" content="#2C2E2F" />
<meta name="keywords" content="{{ .Site.Params.keywords }}">
<meta name="description" content="{{ .Site.Params.Description }}">
<link rel="shortcut icon" href="../images/app-ico.png">
<link rel="apple-touch-icon" href="../images/app-ico.png">
<link rel='stylesheet' id='font-awesome-css'  href='../css/font-awesome.min.css?ver=6.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../css/bootstrap.css?ver=3.4.1' type='text/css' media='all' />
<style type="text/css">
    body {
        background-color: #f4f6f9;
        font-family: "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        padding: 15px;
    }
    .dark-mode {
        background-color: #26282a;
        color: #ddd;
    }
    .goto-container {
        max-width: 600px;
        width: 100%;
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        padding: 30px;
        text-align: center;
        transition: all 0.3s ease;
    }
    .dark-mode .goto-container {
        background-color: #32353a;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
    }
    .site-logo {
        margin-bottom: 20px;
        max-width: 180px;
        height: auto;
    }
    .site-name {
        font-size: 24px;
        font-weight: 600;
        margin: 10px 0;
        color: #333;
    }
    .dark-mode .site-name {
        color: #fff;
    }
    .target-info {
        margin: 25px 0;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 4px;
        text-align: left;
        border-left: 4px solid #4285f4;
    }
    .dark-mode .target-info {
        background-color: #3a3d42;
        border-left: 4px solid #5f9cf9;
    }
    .target-url {
        word-break: break-all;
        margin: 5px 0;
        font-size: 14px;
        color: #555;
    }
    .dark-mode .target-url {
        color: #bbb;
    }
    .target-title {
        font-weight: 600;
        margin: 5px 0 10px;
        font-size: 18px;
        color: #333;
    }
    .dark-mode .target-title {
        color: #eee;
    }
    .progress-container {
        margin: 20px 0;
        background-color: #e0e0e0;
        border-radius: 4px;
        position: relative;
        height: 6px;
        overflow: hidden;
    }
    .dark-mode .progress-container {
        background-color: #555;
    }
    .progress-bar {
        position: absolute;
        height: 100%;
        background-color: #4285f4;
        transition: width 3s linear;
        width: 0%;
    }
    .countdown {
        font-size: 16px;
        color: #666;
        margin: 15px 0;
    }
    .dark-mode .countdown {
        color: #aaa;
    }
    .button-group {
        display: flex;
        justify-content: center;
        margin-top: 25px;
        gap: 15px;
    }
    .btn {
        padding: 8px 20px;
        border-radius: 4px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
    }
    .btn-primary {
        background-color: #4285f4;
        color: white;
        border: none;
    }
    .btn-primary:hover {
        background-color: #3367d6;
    }
    .btn-secondary {
        background-color: #f8f9fa;
        color: #3c4043;
        border: 1px solid #dadce0;
    }
    .dark-mode .btn-secondary {
        background-color: #484b50;
        color: #ddd;
        border: 1px solid #666;
    }
    .btn-secondary:hover {
        background-color: #f1f3f4;
        box-shadow: 0 1px 2px rgba(60, 64, 67, 0.1);
    }
    .dark-mode .btn-secondary:hover {
        background-color: #52565b;
    }
    .safety-notice {
        margin-top: 25px;
        font-size: 13px;
        color: #666;
    }
    .dark-mode .safety-notice {
        color: #999;
    }
    .icon-container {
        display: inline-block;
        width: 48px;
        height: 48px;
        background-color: #f1f3f4;
        border-radius: 50%;
        margin-bottom: 15px;
        line-height: 48px;
        text-align: center;
    }
    .dark-mode .icon-container {
        background-color: #484b50;
    }
    .icon-container i {
        color: #4285f4;
        font-size: 24px;
    }
    .copyright {
        margin-top: 30px;
        font-size: 12px;
        color: #999;
    }
    .dark-mode .copyright {
        color: #777;
    }
</style>
</head>
<body class="{{ if .Site.Params.darkmode.enable }}dark-mode{{ end }}">
    <div class="goto-container">
        <img class="site-logo" src="../images/logo.png" alt="{{ .Site.Title }}">
        <h1 class="site-name">{{ .Site.Title }}</h1>
        
        <div class="icon-container">
            <i class="fa fa-external-link" aria-hidden="true"></i>
        </div>
        
        <div class="target-info">
            <p class="target-title" id="target-title">{{ if .Params.title }}{{ .Params.title }}{{ else }}外部网站{{ end }}</p>
            <p class="target-url" id="target-url">链接：{{ if .Params.targetURL }}{{ .Params.targetURL }}{{ else }}加载中...{{ end }}</p>
        </div>
        
        <div class="countdown">页面将在 <span id="seconds">3</span> 秒后自动跳转</div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="button-group">
            <a href="{{ if .Params.targetURL }}{{ .Params.targetURL }}{{ else }}javascript:void(0);{{ end }}" id="go-button" class="btn btn-primary">立即前往</a>
            <a href="javascript:history.back()" class="btn btn-secondary">返回上页</a>
        </div>
        
        <div class="safety-notice">
            <p>您即将离开"{{ .Site.Title }}"，访问的网页由第三方提供</p>
            <p>本站不对其内容负责，请注意您的账号和隐私安全</p>
        </div>
        
        <div class="copyright">
            Copyright © {{ now.Format "2006"}} <strong>{{ if .Site.Copyright }}{{ .Site.Copyright | safeHTML }}{{ else }}{{ .Site.Title }}{{ end }}</strong>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var seconds = 3;
            var countdownEl = document.getElementById('seconds');
            var progressBar = document.getElementById('progress-bar');
            var targetTitleEl = document.getElementById('target-title');
            var targetUrlEl = document.getElementById('target-url');
            var goButtonEl = document.getElementById('go-button');
            
            // 获取URL中的参数
            function getParameterByName(name) {
                var url = window.location.href;
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }
            
            // 从localStorage获取目标信息
            var gotoId = getParameterByName('id');
            var targetData = null;
            var targetURL = "{{ .Params.targetURL }}";
            
            if (gotoId) {
                var storedData = localStorage.getItem('goto_' + gotoId);
                if (storedData) {
                    try {
                        targetData = JSON.parse(storedData);
                        localStorage.removeItem('goto_' + gotoId); // 使用后立即清除数据
                        
                        // 更新页面元素
                        if (targetData.title) {
                            targetTitleEl.textContent = targetData.title;
                        }
                        
                        if (targetData.targetURL) {
                            targetURL = targetData.targetURL;
                            targetUrlEl.textContent = '链接：' + targetURL;
                            goButtonEl.href = targetURL;
                        }
                    } catch (e) {
                        console.error('解析跳转数据出错:', e);
                    }
                }
            } 
            
            // 回退到页面上指定的URL或默认值
            if (!targetURL || targetURL === "加载中...") {
                targetURL = "{{ if .Params.targetURL }}{{ .Params.targetURL }}{{ else }}javascript:history.back();{{ end }}";
                if (targetURL === "javascript:history.back();") {
                    setTimeout(function() {
                        history.back();
                    }, 100);
                    return;
                }
            }
            
            // 启动进度条动画
            setTimeout(function() {
                progressBar.style.width = '100%';
            }, 100);
            
            // 倒计时
            var countdownInterval = setInterval(function() {
                seconds -= 1;
                countdownEl.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = targetURL;
                }
            }, 1000);
            
            // 检测暗黑模式偏好
            function checkDarkMode() {
                if (localStorage.getItem('darkMode') === 'true' || 
                   (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && localStorage.getItem('darkMode') !== 'false') || 
                   document.body.classList.contains('dark-mode')) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
            }
            
            // 初次检查暗黑模式
            checkDarkMode();
        });
    </script>
</body>
</html>